# éªŒè¯æ¡†æ¶è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»toolkitæ¨¡å—ä¸­éªŒè¯æ¡†æ¶çš„è®¾è®¡æ€è·¯ã€æ¶æ„ç»„æˆå’Œä½¿ç”¨æ–¹æ³•ã€‚éªŒè¯æ¡†æ¶åŸºäºJava Bean Validationï¼ˆJSR-303/JSR-380ï¼‰æ ‡å‡†ï¼Œç»“åˆSpring Validationï¼Œæä¾›äº†å®Œæ•´çš„æ•°æ®éªŒè¯è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

- **å£°æ˜å¼éªŒè¯** - é€šè¿‡æ³¨è§£å£°æ˜éªŒè¯è§„åˆ™
- **åˆ†å±‚éªŒè¯** - æ”¯æŒå‚æ•°éªŒè¯ã€BeanéªŒè¯ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **å¯æ‰©å±•æ€§** - æ”¯æŒè‡ªå®šä¹‰éªŒè¯å™¨å’ŒéªŒè¯è§„åˆ™
- **å›½é™…åŒ–** - æ”¯æŒå¤šè¯­è¨€éªŒè¯æ¶ˆæ¯
- **é«˜æ€§èƒ½** - ä¼˜åŒ–éªŒè¯æ€§èƒ½ï¼Œæ”¯æŒç¼“å­˜
- **æ˜“äºæµ‹è¯•** - æä¾›æµ‹è¯•å·¥å…·å’Œæ¨¡æ‹Ÿ

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. éªŒè¯å±‚æ¬¡ç»“æ„

```
éªŒè¯æ¡†æ¶
â”œâ”€â”€ å‚æ•°éªŒè¯å±‚ (Parameter Validation)
â”‚   â”œâ”€â”€ åŸºç¡€ç±»å‹éªŒè¯ (@NotNull, @NotBlank, @Sizeç­‰)
â”‚   â”œâ”€â”€ æ ¼å¼éªŒè¯ (@Pattern, @Email, @URLç­‰)
â”‚   â””â”€â”€ æ•°å€¼éªŒè¯ (@Min, @Max, @Rangeç­‰)
â”œâ”€â”€ BeanéªŒè¯å±‚ (Bean Validation)
â”‚   â”œâ”€â”€ å±æ€§éªŒè¯ (Field Validation)
â”‚   â”œâ”€â”€ è·¨å­—æ®µéªŒè¯ (Cross-field Validation)
â”‚   â””â”€â”€ ç±»çº§åˆ«éªŒè¯ (Class-level Validation)
â”œâ”€â”€ ä¸šåŠ¡è§„åˆ™éªŒè¯å±‚ (Business Rule Validation)
â”‚   â”œâ”€â”€ å”¯ä¸€æ€§éªŒè¯ (Uniqueness Validation)
â”‚   â”œâ”€â”€ ä¾èµ–éªŒè¯ (Dependency Validation)
â”‚   â””â”€â”€ æƒé™éªŒè¯ (Permission Validation)
â””â”€â”€ è‡ªå®šä¹‰éªŒè¯å±‚ (Custom Validation)
    â”œâ”€â”€ è‡ªå®šä¹‰æ³¨è§£ (Custom Annotations)
    â”œâ”€â”€ è‡ªå®šä¹‰éªŒè¯å™¨ (Custom Validators)
    â””â”€â”€ å¤åˆéªŒè¯å™¨ (Composite Validators)
```

### 2. æ ¸å¿ƒç»„ä»¶

```
éªŒè¯æ¡†æ¶ç»„ä»¶
â”œâ”€â”€ validation/
â”‚   â”œâ”€â”€ annotations/          # éªŒè¯æ³¨è§£
â”‚   â”‚   â”œâ”€â”€ basic/           # åŸºç¡€éªŒè¯æ³¨è§£
â”‚   â”‚   â”œâ”€â”€ business/        # ä¸šåŠ¡éªŒè¯æ³¨è§£
â”‚   â”‚   â””â”€â”€ custom/          # è‡ªå®šä¹‰éªŒè¯æ³¨è§£
â”‚   â”œâ”€â”€ validators/          # éªŒè¯å™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ basic/           # åŸºç¡€éªŒè¯å™¨
â”‚   â”‚   â”œâ”€â”€ business/        # ä¸šåŠ¡éªŒè¯å™¨
â”‚   â”‚   â””â”€â”€ custom/          # è‡ªå®šä¹‰éªŒè¯å™¨
â”‚   â”œâ”€â”€ groups/              # éªŒè¯ç»„
â”‚   â”œâ”€â”€ messages/            # éªŒè¯æ¶ˆæ¯
â”‚   â”œâ”€â”€ config/              # éªŒè¯é…ç½®
â”‚   â””â”€â”€ utils/               # éªŒè¯å·¥å…·ç±»
```

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### 1. åŸºç¡€éªŒè¯æ³¨è§£

#### ç©ºå€¼éªŒè¯
```java
public class UserCreateRequest {
    @NotNull(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©ºç™½")
    private String username;
    
    @NotEmpty(message = "è§’è‰²åˆ—è¡¨ä¸èƒ½ä¸ºç©º")
    private List<String> roles;
}
```

#### é•¿åº¦å’Œå¤§å°éªŒè¯
```java
public class UserCreateRequest {
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20å­—ç¬¦ä¹‹é—´")
    private String username;
    
    @Length(min = 6, max = 50, message = "å¯†ç é•¿åº¦å¿…é¡»åœ¨6-50å­—ç¬¦ä¹‹é—´")
    private String password;
    
    @Range(min = 18, max = 100, message = "å¹´é¾„å¿…é¡»åœ¨18-100ä¹‹é—´")
    private Integer age;
}
```

#### æ ¼å¼éªŒè¯
```java
public class UserCreateRequest {
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String mobile;
    
    @URL(message = "ç½‘å€æ ¼å¼ä¸æ­£ç¡®")
    private String website;
}
```

### 2. è‡ªå®šä¹‰éªŒè¯æ³¨è§£

#### ä¸šåŠ¡éªŒè¯æ³¨è§£
```java
// ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯
@UniqueUsername(message = "ç”¨æˆ·åå·²å­˜åœ¨")
public class UserCreateRequest {
    private String username;
}

// æ‰‹æœºå·éªŒè¯
@ValidMobile(message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
public class UserCreateRequest {
    private String mobile;
}

// èº«ä»½è¯éªŒè¯
@ValidIdCard(message = "èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡®")
public class UserCreateRequest {
    private String idCard;
}

// å¯†ç å¼ºåº¦éªŒè¯
@StrongPassword(message = "å¯†ç å¼ºåº¦ä¸è¶³")
public class UserCreateRequest {
    private String password;
}
```

#### è·¨å­—æ®µéªŒè¯
```java
@PasswordMatch(message = "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")
public class UserCreateRequest {
    private String password;
    private String confirmPassword;
}

@DateRange(start = "startDate", end = "endDate", message = "ç»“æŸæ—¥æœŸå¿…é¡»å¤§äºå¼€å§‹æ—¥æœŸ")
public class TimeRangeQuery {
    private LocalDate startDate;
    private LocalDate endDate;
}
```

### 3. éªŒè¯ç»„

#### åœºæ™¯åŒ–éªŒè¯
```java
public interface CreateGroup {}
public interface UpdateGroup {}

public class UserRequest {
    @NotNull(groups = {CreateGroup.class, UpdateGroup.class})
    private String username;
    
    @NotNull(groups = CreateGroup.class)
    private String password;
    
    @Null(groups = CreateGroup.class)
    @NotNull(groups = UpdateGroup.class)
    private Long id;
}

// ä½¿ç”¨éªŒè¯ç»„
@PostMapping("/users")
public Response<User> createUser(@Validated(CreateGroup.class) @RequestBody UserRequest request) {
    // åˆ›å»ºç”¨æˆ·é€»è¾‘
}

@PutMapping("/users/{id}")
public Response<User> updateUser(@Validated(UpdateGroup.class) @RequestBody UserRequest request) {
    // æ›´æ–°ç”¨æˆ·é€»è¾‘
}
```

#### éªŒè¯åºåˆ—
```java
@GroupSequence({BasicGroup.class, BusinessGroup.class})
public interface UserValidationSequence {}

public class UserRequest {
    @NotNull(groups = BasicGroup.class)
    private String username;
    
    @UniqueUsername(groups = BusinessGroup.class)
    private String username;
}
```

### 4. æ¡ä»¶éªŒè¯

```java
@ConditionalValidation(
    condition = "type == 'EMAIL'",
    validations = {
        @ConditionalField(field = "email", constraints = @Email)
    }
)
@ConditionalValidation(
    condition = "type == 'SMS'", 
    validations = {
        @ConditionalField(field = "mobile", constraints = @ValidMobile)
    }
)
public class NotificationRequest {
    private String type;
    private String email;
    private String mobile;
}
```

## ğŸ› ï¸ è‡ªå®šä¹‰éªŒè¯å™¨

### 1. ç®€å•éªŒè¯å™¨

```java
// æ‰‹æœºå·éªŒè¯æ³¨è§£
@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = MobileValidator.class)
@Documented
public @interface ValidMobile {
    String message() default "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

// æ‰‹æœºå·éªŒè¯å™¨
public class MobileValidator implements ConstraintValidator<ValidMobile, String> {
    
    private static final Pattern MOBILE_PATTERN = 
        Pattern.compile("^1[3-9]\\d{9}$");
    
    @Override
    public boolean isValid(String value, ConstraintValidatorContext context) {
        if (value == null) {
            return true; // ç©ºå€¼ç”±@NotNullå¤„ç†
        }
        return MOBILE_PATTERN.matcher(value).matches();
    }
}
```

### 2. ä¸šåŠ¡éªŒè¯å™¨

```java
// ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯æ³¨è§£
@Target({ElementType.TYPE, ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = UniqueUsernameValidator.class)
@Documented
public @interface UniqueUsername {
    String message() default "ç”¨æˆ·åå·²å­˜åœ¨";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
    
    String field() default "username";
    boolean ignoreCase() default false;
}

// ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯å™¨
@Component
public class UniqueUsernameValidator implements ConstraintValidator<UniqueUsername, Object> {
    
    @Autowired
    private UserRepository userRepository;
    
    private String fieldName;
    private boolean ignoreCase;
    
    @Override
    public void initialize(UniqueUsername annotation) {
        this.fieldName = annotation.field();
        this.ignoreCase = annotation.ignoreCase();
    }
    
    @Override
    public boolean isValid(Object value, ConstraintValidatorContext context) {
        if (value == null) {
            return true;
        }
        
        try {
            Field field = value.getClass().getDeclaredField(fieldName);
            field.setAccessible(true);
            String username = (String) field.get(value);
            
            if (username == null) {
                return true;
            }
            
            return !userRepository.existsByUsername(username, ignoreCase);
            
        } catch (Exception e) {
            log.error("ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯å¤±è´¥", e);
            return false;
        }
    }
}
```

### 3. è·¨å­—æ®µéªŒè¯å™¨

```java
// å¯†ç ç¡®è®¤éªŒè¯æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = PasswordMatchValidator.class)
@Documented
public @interface PasswordMatch {
    String message() default "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
    
    String password() default "password";
    String confirmPassword() default "confirmPassword";
}

// å¯†ç ç¡®è®¤éªŒè¯å™¨
public class PasswordMatchValidator implements ConstraintValidator<PasswordMatch, Object> {
    
    private String passwordField;
    private String confirmPasswordField;
    
    @Override
    public void initialize(PasswordMatch annotation) {
        this.passwordField = annotation.password();
        this.confirmPasswordField = annotation.confirmPassword();
    }
    
    @Override
    public boolean isValid(Object value, ConstraintValidatorContext context) {
        try {
            Field passwordField = value.getClass().getDeclaredField(this.passwordField);
            Field confirmPasswordField = value.getClass().getDeclaredField(this.confirmPasswordField);
            
            passwordField.setAccessible(true);
            confirmPasswordField.setAccessible(true);
            
            String password = (String) passwordField.get(value);
            String confirmPassword = (String) confirmPasswordField.get(value);
            
            return Objects.equals(password, confirmPassword);
            
        } catch (Exception e) {
            return false;
        }
    }
}
```

## ğŸ”§ éªŒè¯é…ç½®

### 1. Spring Boot é…ç½®

```java
@Configuration
@EnableValidation
public class ValidationConfig {
    
    @Bean
    public Validator validator() {
        ValidatorFactory factory = Validation.byProvider(HibernateValidator.class)
                .configure()
                .messageInterpolator(messageInterpolator())
                .buildValidatorFactory();
        return factory.getValidator();
    }
    
    @Bean
    public MessageInterpolator messageInterpolator() {
        return new ResourceBundleMessageInterpolator(
                new PlatformResourceBundleLocator("ValidationMessages")
        );
    }
    
    @Bean
    public MethodValidationPostProcessor methodValidationPostProcessor(Validator validator) {
        MethodValidationPostProcessor processor = new MethodValidationPostProcessor();
        processor.setValidator(validator);
        return processor;
    }
}
```

### 2. éªŒè¯æ¶ˆæ¯é…ç½®

```properties
# ValidationMessages.properties
validation.user.username.notblank=ç”¨æˆ·åä¸èƒ½ä¸ºç©º
validation.user.username.size=ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨{min}-{max}å­—ç¬¦ä¹‹é—´
validation.user.email.invalid=é‚®ç®±æ ¼å¼ä¸æ­£ç¡®
validation.user.mobile.invalid=æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®
validation.user.password.weak=å¯†ç å¼ºåº¦ä¸è¶³ï¼Œè‡³å°‘åŒ…å«8ä½å­—ç¬¦ï¼ŒåŒ…æ‹¬å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
validation.user.password.mismatch=ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´
validation.user.username.exists=ç”¨æˆ·å "{validatedValue}" å·²å­˜åœ¨

# ValidationMessages_zh_CN.properties
validation.user.username.notblank=ç”¨æˆ·åä¸èƒ½ä¸ºç©º
validation.user.username.size=ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨{min}-{max}å­—ç¬¦ä¹‹é—´

# ValidationMessages_en_US.properties
validation.user.username.notblank=Username cannot be blank
validation.user.username.size=Username length must be between {min}-{max} characters
```

### 3. å…¨å±€éªŒè¯é…ç½®

```java
@Configuration
public class GlobalValidationConfig {
    
    @Bean
    public GlobalValidator globalValidator() {
        return GlobalValidator.builder()
                .failFast(false)                    // ä¸å¿«é€Ÿå¤±è´¥ï¼Œæ”¶é›†æ‰€æœ‰é”™è¯¯
                .enableGroups(true)                 // å¯ç”¨éªŒè¯ç»„
                .enableCrossFieldValidation(true)   // å¯ç”¨è·¨å­—æ®µéªŒè¯
                .enableBusinessValidation(true)     // å¯ç”¨ä¸šåŠ¡éªŒè¯
                .cacheValidationResults(true)       // ç¼“å­˜éªŒè¯ç»“æœ
                .build();
    }
}
```

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### 1. Controller å±‚éªŒè¯

```java
@RestController
@RequestMapping("/api/users")
@Validated
public class UserController {
    
    // è¯·æ±‚ä½“éªŒè¯
    @PostMapping
    public Response<User> createUser(@Valid @RequestBody UserCreateRequest request) {
        User user = userService.createUser(request);
        return Response.success(user);
    }
    
    // è·¯å¾„å‚æ•°éªŒè¯
    @GetMapping("/{id}")
    public Response<User> getUser(@PathVariable @Min(value = 1, message = "ç”¨æˆ·IDå¿…é¡»å¤§äº0") Long id) {
        User user = userService.getUser(id);
        return Response.success(user);
    }
    
    // æŸ¥è¯¢å‚æ•°éªŒè¯
    @GetMapping
    public Response<List<User>> queryUsers(
            @RequestParam @Size(min = 2, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨2-20å­—ç¬¦ä¹‹é—´") String username,
            @RequestParam @Valid UserQueryRequest query) {
        List<User> users = userService.queryUsers(username, query);
        return Response.success(users);
    }
    
    // éªŒè¯ç»„ä½¿ç”¨
    @PostMapping("/register")
    public Response<User> register(@Validated(RegisterGroup.class) @RequestBody UserRequest request) {
        User user = userService.register(request);
        return Response.success(user);
    }
}
```

### 2. Service å±‚éªŒè¯

```java
@Service
@Validated
public class UserService {
    
    // æ–¹æ³•å‚æ•°éªŒè¯
    @Validated(CreateGroup.class)
    public User createUser(@Valid UserCreateRequest request) {
        // æ‰‹åŠ¨è§¦å‘éªŒè¯
        ValidationUtils.validate(request, CreateGroup.class);
        
        // ä¸šåŠ¡é€»è¾‘
        User user = userConverter.toEntity(request);
        return userRepository.save(user);
    }
    
    // è¿”å›å€¼éªŒè¯
    @Validated
    public @Valid User updateUser(@Valid UserUpdateRequest request) {
        User existingUser = getUser(request.getId());
        userConverter.updateEntity(existingUser, request);
        return userRepository.save(existingUser);
    }
}
```

### 3. è‡ªå®šä¹‰éªŒè¯é€»è¾‘

```java
@Component
public class UserValidationService {
    
    public void validateUserCreation(UserCreateRequest request) {
        // åŸºç¡€éªŒè¯
        ValidationResult basicResult = ValidationUtils.validate(request);
        if (basicResult.hasErrors()) {
            throw new ValidationException(basicResult.getErrors());
        }
        
        // ä¸šåŠ¡è§„åˆ™éªŒè¯
        validateBusinessRules(request);
    }
    
    private void validateBusinessRules(UserCreateRequest request) {
        // ç”¨æˆ·åå”¯ä¸€æ€§
        if (userRepository.existsByUsername(request.getUsername())) {
            throw new BusinessException(I18nCommonExceptionCode.USER_ALREADY_EXISTS);
        }
        
        // é‚®ç®±å”¯ä¸€æ€§
        if (userRepository.existsByEmail(request.getEmail())) {
            throw new BusinessException(I18nCommonExceptionCode.EMAIL_ALREADY_EXISTS);
        }
        
        // å¯†ç å¼ºåº¦éªŒè¯
        if (!PasswordUtils.isStrongPassword(request.getPassword())) {
            throw new BusinessException(I18nCommonExceptionCode.PASSWORD_TOO_WEAK);
        }
    }
}
```

### 4. æ‰¹é‡éªŒè¯

```java
@Service
public class BatchValidationService {
    
    public void validateUsers(List<UserCreateRequest> requests) {
        // æ‰¹é‡éªŒè¯
        List<ValidationResult> results = ValidationUtils.validateBatch(requests);
        
        // æ”¶é›†æ‰€æœ‰é”™è¯¯
        List<String> errors = results.stream()
                .filter(ValidationResult::hasErrors)
                .flatMap(result -> result.getErrors().stream())
                .map(FieldError::getDefaultMessage)
                .collect(Collectors.toList());
        
        if (!errors.isEmpty()) {
            throw new ValidationException("æ‰¹é‡éªŒè¯å¤±è´¥", errors);
        }
    }
    
    public void validateUsersWithGroups(List<UserCreateRequest> requests) {
        // ä½¿ç”¨éªŒè¯ç»„è¿›è¡Œæ‰¹é‡éªŒè¯
        ValidationUtils.validateBatch(requests, CreateGroup.class);
    }
}
```

## ğŸ§ª æµ‹è¯•æ”¯æŒ

### 1. éªŒè¯æµ‹è¯•å·¥å…·

```java
@TestComponent
public class ValidationTestUtils {
    
    private static final Validator validator = Validation.buildDefaultValidatorFactory().getValidator();
    
    public static <T> Set<ConstraintViolation<T>> validate(T object) {
        return validator.validate(object);
    }
    
    public static <T> Set<ConstraintViolation<T>> validate(T object, Class<?>... groups) {
        return validator.validate(object, groups);
    }
    
    public static <T> void assertValid(T object) {
        Set<ConstraintViolation<T>> violations = validate(object);
        if (!violations.isEmpty()) {
            String errors = violations.stream()
                    .map(ConstraintViolation::getMessage)
                    .collect(Collectors.joining(", "));
            throw new AssertionError("éªŒè¯å¤±è´¥: " + errors);
        }
    }
    
    public static <T> void assertInvalid(T object, String expectedMessage) {
        Set<ConstraintViolation<T>> violations = validate(object);
        assertTrue("åº”è¯¥æœ‰éªŒè¯é”™è¯¯", !violations.isEmpty());
        
        boolean found = violations.stream()
                .anyMatch(v -> v.getMessage().contains(expectedMessage));
        assertTrue("æœªæ‰¾åˆ°æœŸæœ›çš„é”™è¯¯æ¶ˆæ¯: " + expectedMessage, found);
    }
}
```

### 2. éªŒè¯å•å…ƒæµ‹è¯•

```java
@ExtendWith(MockitoExtension.class)
class UserCreateRequestValidationTest {
    
    @Test
    void testValidUser() {
        // given
        UserCreateRequest request = UserCreateRequest.builder()
                .username("testuser")
                .email("test@example.com")
                .password("StrongP@ss123")
                .age(25)
                .build();
        
        // when & then
        ValidationTestUtils.assertValid(request);
    }
    
    @Test
    void testInvalidUser_BlankUsername() {
        // given
        UserCreateRequest request = UserCreateRequest.builder()
                .username("")
                .email("test@example.com")
                .password("StrongP@ss123")
                .build();
        
        // when & then
        ValidationTestUtils.assertInvalid(request, "ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
    }
    
    @Test
    void testInvalidUser_InvalidEmail() {
        // given
        UserCreateRequest request = UserCreateRequest.builder()
                .username("testuser")
                .email("invalid-email")
                .password("StrongP@ss123")
                .build();
        
        // when & then
        ValidationTestUtils.assertInvalid(request, "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
    }
    
    @Test
    void testValidationGroups() {
        // given
        UserRequest request = new UserRequest();
        request.setUsername("testuser");
        // åˆ›å»ºæ—¶ä¸è®¾ç½®ID
        
        // when & then
        Set<ConstraintViolation<UserRequest>> violations = 
                ValidationTestUtils.validate(request, CreateGroup.class);
        
        assertTrue("åˆ›å»ºæ—¶åº”è¯¥é€šè¿‡éªŒè¯", violations.isEmpty());
    }
}
```

### 3. è‡ªå®šä¹‰éªŒè¯å™¨æµ‹è¯•

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = TestConfig.class)
class UniqueUsernameValidatorTest {
    
    @MockBean
    private UserRepository userRepository;
    
    @Autowired
    private Validator validator;
    
    @Test
    void testUniqueUsername_Success() {
        // given
        when(userRepository.existsByUsername("newuser", false)).thenReturn(false);
        
        UserCreateRequest request = new UserCreateRequest();
        request.setUsername("newuser");
        
        // when
        Set<ConstraintViolation<UserCreateRequest>> violations = validator.validate(request);
        
        // then
        assertTrue("ç”¨æˆ·åå”¯ä¸€æ—¶åº”è¯¥é€šè¿‡éªŒè¯", violations.isEmpty());
    }
    
    @Test
    void testUniqueUsername_Failure() {
        // given
        when(userRepository.existsByUsername("existinguser", false)).thenReturn(true);
        
        UserCreateRequest request = new UserCreateRequest();
        request.setUsername("existinguser");
        
        // when
        Set<ConstraintViolation<UserCreateRequest>> violations = validator.validate(request);
        
        // then
        assertFalse("ç”¨æˆ·åé‡å¤æ—¶åº”è¯¥éªŒè¯å¤±è´¥", violations.isEmpty());
        assertTrue("åº”è¯¥åŒ…å«ç”¨æˆ·åå·²å­˜åœ¨çš„é”™è¯¯", 
                violations.stream().anyMatch(v -> v.getMessage().contains("ç”¨æˆ·åå·²å­˜åœ¨")));
    }
}
```

## ğŸ”§ é«˜çº§ç‰¹æ€§

### 1. æ¡ä»¶éªŒè¯

```java
@ConditionalValidation(
    condition = "#{type == 'ENTERPRISE'}",
    validations = {
        @ConditionalField(field = "companyName", constraints = @NotBlank),
        @ConditionalField(field = "taxNumber", constraints = @Pattern(regexp = "\\d{15}"))
    }
)
public class UserRegistrationRequest {
    private UserType type;
    private String companyName;
    private String taxNumber;
}
```

### 2. åŠ¨æ€éªŒè¯è§„åˆ™

```java
@Component
public class DynamicValidationService {
    
    public void validateWithDynamicRules(Object object, String ruleSetName) {
        ValidationRuleSet ruleSet = ruleSetRepository.findByName(ruleSetName);
        
        for (ValidationRule rule : ruleSet.getRules()) {
            Object fieldValue = ReflectionUtils.getFieldValue(object, rule.getFieldName());
            
            if (!rule.validate(fieldValue)) {
                throw new ValidationException(rule.getErrorMessage());
            }
        }
    }
}
```

### 3. æ€§èƒ½ä¼˜åŒ–

```java
@Configuration
public class ValidationPerformanceConfig {
    
    @Bean
    @ConditionalOnProperty(name = "validation.cache.enabled", havingValue = "true")
    public ValidationResultCache validationResultCache() {
        return CacheBuilder.newBuilder()
                .maximumSize(1000)
                .expireAfterWrite(1, TimeUnit.HOURS)
                .build();
    }
    
    @Bean
    public AsyncValidationService asyncValidationService() {
        return new AsyncValidationService(
                Executors.newFixedThreadPool(4)
        );
    }
}
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. éªŒè¯æ³¨è§£ä½¿ç”¨åŸåˆ™

- **å•ä¸€èŒè´£**: æ¯ä¸ªéªŒè¯æ³¨è§£åªå…³æ³¨ä¸€ä¸ªéªŒè¯è§„åˆ™
- **ç»„åˆä½¿ç”¨**: ä½¿ç”¨å¤šä¸ªæ³¨è§£ç»„åˆå®ç°å¤æ‚éªŒè¯
- **ä¸šåŠ¡åˆ†ç¦»**: åŸºç¡€éªŒè¯å’Œä¸šåŠ¡éªŒè¯åˆ†ç¦»
- **æ€§èƒ½ä¼˜å…ˆ**: å…ˆæ‰§è¡Œç®€å•éªŒè¯ï¼Œå†æ‰§è¡Œå¤æ‚éªŒè¯

### 2. é”™è¯¯æ¶ˆæ¯æœ€ä½³å®è·µ

- **ç”¨æˆ·å‹å¥½**: é”™è¯¯æ¶ˆæ¯åº”è¯¥æ˜“äºç†è§£
- **å…·ä½“æ˜ç¡®**: æ˜ç¡®æŒ‡å‡ºé”™è¯¯çš„åŸå› å’Œè§£å†³æ–¹æ³•
- **å›½é™…åŒ–**: æ”¯æŒå¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯
- **å‚æ•°åŒ–**: ä½¿ç”¨å‚æ•°åŒ–æ¶ˆæ¯æ¨¡æ¿

### 3. éªŒè¯ç»„ä½¿ç”¨å»ºè®®

- **åœºæ™¯åˆ†ç»„**: æ ¹æ®ä¸šåŠ¡åœºæ™¯å®šä¹‰éªŒè¯ç»„
- **å±‚æ¬¡åˆ†ç»„**: ä½¿ç”¨éªŒè¯åºåˆ—æ§åˆ¶éªŒè¯é¡ºåº
- **é»˜è®¤ç»„**: åˆç†ä½¿ç”¨é»˜è®¤éªŒè¯ç»„
- **ç»„åˆéªŒè¯**: æ”¯æŒå¤šç»„éªŒè¯ç»„åˆä½¿ç”¨

### 4. æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **ç¼“å­˜ç»“æœ**: ç¼“å­˜éªŒè¯ç»“æœé¿å…é‡å¤è®¡ç®—
- **å¼‚æ­¥éªŒè¯**: å¯¹äºå¤æ‚çš„ä¸šåŠ¡éªŒè¯ä½¿ç”¨å¼‚æ­¥å¤„ç†
- **æ‰¹é‡éªŒè¯**: æ‰¹é‡æ•°æ®ä½¿ç”¨æ‰¹é‡éªŒè¯
- **ç´¢å¼•ä¼˜åŒ–**: ä¸šåŠ¡éªŒè¯æ¶‰åŠçš„æ•°æ®åº“æŸ¥è¯¢è¦æœ‰åˆé€‚çš„ç´¢å¼•

## ğŸ“š å‚è€ƒèµ„æ–™

- [Bean Validation 2.0 Specification (JSR 380)](https://beanvalidation.org/2.0/spec/)
- [Hibernate Validator Documentation](https://hibernate.org/validator/documentation/)
- [Spring Framework Validation](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validation)
- [Spring Boot Validation](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.validation)