# å¼‚å¸¸ä½“ç³»è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº† toolkit æ¨¡å—ä¸­å¼‚å¸¸ä½“ç³»çš„è®¾è®¡æ€è·¯ã€æ¶æ„ç»„æˆã€ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚è¯¥å¼‚å¸¸ä½“ç³»æ”¯æŒå›½é™…åŒ–ï¼Œé‡‡ç”¨ç®€åŒ–è®¾è®¡ï¼ŒåªåŒºåˆ†ä¸šåŠ¡å¼‚å¸¸å’Œç³»ç»Ÿå¼‚å¸¸ï¼Œæä¾›äº†ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. å¼‚å¸¸ä½“ç³»å±‚æ¬¡ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰

```
RuntimeException
    â””â”€â”€ BaseException (åŸºç¡€å¼‚å¸¸ç±»)
        â”œâ”€â”€ BusinessException (ä¸šåŠ¡å¼‚å¸¸ - åŒ…å«éªŒè¯ã€è®¤è¯ç­‰æ‰€æœ‰ä¸šåŠ¡ç›¸å…³å¼‚å¸¸)
        â””â”€â”€ SystemException (ç³»ç»Ÿå¼‚å¸¸ - æ•°æ®åº“ã€ç½‘ç»œç­‰ç³»ç»Ÿçº§å¼‚å¸¸)
```

### 2. å¼‚å¸¸ç ä½“ç³»

```
ExceptionCode (åŸºç¡€å¼‚å¸¸ç æ¥å£)
    â””â”€â”€ I18nExceptionCode (å›½é™…åŒ–å¼‚å¸¸ç æ¥å£)
        â”œâ”€â”€ CommonExceptionCode (é€šç”¨å¼‚å¸¸ç æšä¸¾)
        â””â”€â”€ I18nCommonExceptionCode (å›½é™…åŒ–é€šç”¨å¼‚å¸¸ç æšä¸¾)
```

### 3. æ ¸å¿ƒç»„ä»¶

- **BaseException**: æ‰€æœ‰ä¸šåŠ¡å¼‚å¸¸çš„åŸºç±»
- **BusinessException**: ä¸šåŠ¡å¼‚å¸¸ï¼ˆåŒ…å«éªŒè¯ã€è®¤è¯ç­‰ï¼‰
- **SystemException**: ç³»ç»Ÿå¼‚å¸¸ï¼ˆæ•°æ®åº“ã€ç½‘ç»œç­‰ï¼‰
- **I18nExceptionCode**: æ”¯æŒå›½é™…åŒ–çš„å¼‚å¸¸ç æ¥å£
- **I18nMessageService**: å›½é™…åŒ–æ¶ˆæ¯æœåŠ¡
- **ExceptionUtils**: å¼‚å¸¸å·¥å…·ç±»
- **Assert**: æ–­è¨€å·¥å…·ç±»
- **GlobalExceptionHandler**: å…¨å±€å¼‚å¸¸å¤„ç†å™¨

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. ç®€åŒ–ä¼˜å…ˆ
- **åªåŒºåˆ†ä¸šåŠ¡å¼‚å¸¸å’Œç³»ç»Ÿå¼‚å¸¸** - Authã€Validation ç­‰éƒ½å½’ç±»ä¸ºä¸šåŠ¡å¼‚å¸¸
- **é¿å…è¿‡åº¦åˆ†ç±»** - å‡å°‘å¼€å‘è€…çš„é€‰æ‹©å›°éš¾ï¼Œæé«˜å¼€å‘æ•ˆç‡
- **ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶** - ç®€åŒ–å¼‚å¸¸å¤„ç†é€»è¾‘

### 2. å›½é™…åŒ–æ”¯æŒ
- æ”¯æŒå¤šè¯­è¨€å¼‚å¸¸æ¶ˆæ¯
- å‚æ•°åŒ–æ¶ˆæ¯æ¨¡æ¿
- è‡ªåŠ¨è¯­è¨€ç¯å¢ƒæ£€æµ‹

### 3. å®ç”¨æ€§è®¾è®¡
- **Assert** - æä¾›æ–­è¨€é£æ ¼çš„éªŒè¯æ–¹æ³•
- **ExceptionUtils** - æä¾›ä¾¿æ·çš„å¼‚å¸¸åˆ›å»ºå’ŒæŠ›å‡ºæ–¹æ³•
- æŒ‰é”™è¯¯ç åˆ†ç±»ï¼ˆ4xxå®¢æˆ·ç«¯é”™è¯¯ã€5xxæœåŠ¡ç«¯é”™è¯¯ã€1xxxä¸šåŠ¡é”™è¯¯ç­‰ï¼‰

### 4. æ˜“ç”¨æ€§
- è¯­ä¹‰æ¸…æ™°çš„æ–¹æ³•å‘½å
- æ”¯æŒå¤šç§è°ƒç”¨æ–¹å¼
- ä¸°å¯Œçš„å·¥å…·æ–¹æ³•

## ğŸ“Š å¼‚å¸¸ç è§„èŒƒ

### é”™è¯¯ç åˆ†ç±»

| èŒƒå›´ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| 0 | æˆåŠŸ | æ“ä½œæˆåŠŸ | 0 |
| 4xx | å®¢æˆ·ç«¯é”™è¯¯ | HTTPæ ‡å‡†é”™è¯¯ç  | 400, 401, 403, 404 |
| 5xx | æœåŠ¡ç«¯é”™è¯¯ | HTTPæ ‡å‡†é”™è¯¯ç  | 500, 501, 503 |
| 1000-1099 | é€šç”¨ä¸šåŠ¡é”™è¯¯ | åŸºç¡€ä¸šåŠ¡å¼‚å¸¸ | 1000, 1001, 1002 |
| 1100-1199 | å‚æ•°éªŒè¯é”™è¯¯ | å‚æ•°æ ¼å¼ã€èŒƒå›´ç­‰ | 1100, 1101, 1102 |
| 1200-1299 | ç”¨æˆ·ç›¸å…³é”™è¯¯ | ç”¨æˆ·æ“ä½œç›¸å…³ | 1200, 1201, 1202 |
| 2000-2999 | æ•°æ®åº“é”™è¯¯ | æ•°æ®åº“æ“ä½œå¼‚å¸¸ | 2000, 2001, 2002 |
| 3000-3999 | å¤–éƒ¨æœåŠ¡é”™è¯¯ | ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨ | 3000, 3001, 3002 |
| 4000-4999 | æ–‡ä»¶æ“ä½œé”™è¯¯ | æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ç­‰ | 4000, 4001, 4002 |

### å¼‚å¸¸ç å‘½åè§„èŒƒ

```java
// æ ¼å¼ï¼š[æ¨¡å—]_[æ“ä½œ]_[ç»“æœ]
USER_LOGIN_FAILED("1203", "exception.user_login_failed", "ç”¨æˆ·ç™»å½•å¤±è´¥"),
FILE_UPLOAD_SIZE_EXCEEDED("4003", "exception.file_upload_size_exceeded", "æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶ {0}MB");
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. åŸºç¡€ä½¿ç”¨

#### æŠ›å‡ºå¼‚å¸¸

```java
// ä½¿ç”¨å¼‚å¸¸å·¥å…·ç±»
ExceptionUtils.throwBusiness(I18nCommonExceptionCode.DATA_NOT_FOUND);

// å¸¦å‚æ•°çš„å¼‚å¸¸
ExceptionUtils.throwValidation(I18nCommonExceptionCode.PARAM_REQUIRED, "username");

// æ¡ä»¶å¼‚å¸¸
ExceptionUtils.throwBusinessIf(user == null, I18nCommonExceptionCode.USER_NOT_FOUND);
```

#### åˆ›å»ºå¼‚å¸¸

```java
// åˆ›å»ºä½†ä¸æŠ›å‡º
BusinessException exception = ExceptionUtils.business(I18nCommonExceptionCode.DATA_ALREADY_EXISTS);

// å¸¦åŸå› çš„ç³»ç»Ÿå¼‚å¸¸
SystemException sysException = ExceptionUtils.system(I18nCommonExceptionCode.DATABASE_ERROR, cause);
```

### 2. å‚æ•°éªŒè¯

```java
public void createUser(CreateUserRequest request) {
    // éªŒè¯å¿…å¡«å‚æ•°
    ExceptionUtils.requireNonNull(request, "request");
    ExceptionUtils.requireNonBlank(request.getUsername(), "username");
    ExceptionUtils.requireNonBlank(request.getEmail(), "email");
    
    // éªŒè¯ä¸šåŠ¡è§„åˆ™
    ExceptionUtils.requireTrue(isValidEmail(request.getEmail()), 
                              I18nCommonExceptionCode.EMAIL_INVALID);
    
    // éªŒè¯ç”¨æˆ·ä¸å­˜åœ¨
    ExceptionUtils.throwBusinessIf(userExists(request.getUsername()), 
                                  I18nCommonExceptionCode.USER_ALREADY_EXISTS);
}
```

### 3. è‡ªå®šä¹‰å¼‚å¸¸ç 

```java
public enum UserExceptionCode implements I18nExceptionCode {
    USER_LOGIN_FAILED("1203", "exception.user_login_failed", "ç”¨æˆ·ç™»å½•å¤±è´¥"),
    USER_ACCOUNT_LOCKED("1204", "exception.user_account_locked", "ç”¨æˆ·è´¦æˆ·å·²é”å®š"),
    USER_PASSWORD_WEAK("1205", "exception.user_password_weak", "å¯†ç å¼ºåº¦ä¸è¶³");
    
    private final String code;
    private final String messageKey;
    private final String desc;
    
    // æ„é€ å‡½æ•°å’Œgetteræ–¹æ³•...
}
```

### 4. å›½é™…åŒ–é…ç½®

#### Spring Boot é…ç½®

```java
@Configuration
public class I18nConfig {
    
    @Bean
    public MessageSource messageSource() {
        ResourceBundleMessageSource messageSource = new ResourceBundleMessageSource();
        messageSource.setBasename("messages");
        messageSource.setDefaultEncoding("UTF-8");
        messageSource.setCacheSeconds(3600);
        return messageSource;
    }
    
    @Bean
    public LocaleResolver localeResolver() {
        AcceptHeaderLocaleResolver resolver = new AcceptHeaderLocaleResolver();
        resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
        return resolver;
    }
}
```

#### èµ„æºæ–‡ä»¶ç»“æ„

```
src/main/resources/
â”œâ”€â”€ messages.properties              # é»˜è®¤è¯­è¨€ï¼ˆè‹±æ–‡ï¼‰
â”œâ”€â”€ messages_zh_CN.properties       # ç®€ä½“ä¸­æ–‡
â”œâ”€â”€ messages_zh_TW.properties       # ç¹ä½“ä¸­æ–‡
â”œâ”€â”€ messages_en_US.properties       # ç¾å¼è‹±æ–‡
â””â”€â”€ messages_ja_JP.properties       # æ—¥æ–‡
```

### 5. å…¨å±€å¼‚å¸¸å¤„ç†

å…¨å±€å¼‚å¸¸å¤„ç†å™¨ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰å¼‚å¸¸ï¼Œå¹¶è¿”å›ç»Ÿä¸€æ ¼å¼çš„å“åº”ï¼š

```json
{
  "code": 1001,
  "message": "æ•°æ®ä¸å­˜åœ¨",
  "data": null
}
```

## ğŸŒ å›½é™…åŒ–æ”¯æŒ

### 1. æ¶ˆæ¯æ¨¡æ¿

æ”¯æŒå‚æ•°åŒ–æ¶ˆæ¯æ¨¡æ¿ï¼š

```properties
# è‹±æ–‡
exception.param_out_of_range=Parameter {0} is out of range [{1}, {2}]
exception.file_size_exceeded=File size exceeds limit {0}MB

# ä¸­æ–‡
exception.param_out_of_range=å‚æ•° {0} è¶…å‡ºèŒƒå›´ [{1}, {2}]
exception.file_size_exceeded=æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶ {0}MB
```

### 2. ä½¿ç”¨ç¤ºä¾‹

```java
// æŠ›å‡ºå¸¦å‚æ•°çš„å¼‚å¸¸
ExceptionUtils.throwValidation(
    I18nCommonExceptionCode.PARAM_OUT_OF_RANGE, 
    "age", "18", "65"
);

// æ ¹æ®å½“å‰è¯­è¨€ç¯å¢ƒï¼Œä¼šæ˜¾ç¤ºï¼š
// è‹±æ–‡ï¼šParameter age is out of range [18, 65]
// ä¸­æ–‡ï¼šå‚æ•° age è¶…å‡ºèŒƒå›´ [18, 65]
```

### 3. è¯­è¨€ç¯å¢ƒæ£€æµ‹

```java
@Autowired
private I18nMessageService messageService;

public void someMethod() {
    if (messageService.isChinese()) {
        // ä¸­æ–‡ç¯å¢ƒç‰¹æ®Šå¤„ç†
    } else if (messageService.isEnglish()) {
        // è‹±æ–‡ç¯å¢ƒç‰¹æ®Šå¤„ç†
    }
}
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. å¼‚å¸¸åˆ†ç±»åŸåˆ™

- **BusinessException**: ä¸šåŠ¡é€»è¾‘å¼‚å¸¸ï¼Œç”¨æˆ·å¯ç†è§£çš„é”™è¯¯
- **ValidationException**: å‚æ•°éªŒè¯å¼‚å¸¸ï¼Œè¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯
- **SystemException**: ç³»ç»Ÿçº§å¼‚å¸¸ï¼Œå¦‚æ•°æ®åº“è¿æ¥å¤±è´¥
- **AuthException**: è®¤è¯æˆæƒå¼‚å¸¸ï¼Œæƒé™ç›¸å…³é”™è¯¯

### 2. å¼‚å¸¸æ¶ˆæ¯è®¾è®¡

```java
// âœ… å¥½çš„åšæ³•ï¼šæ¶ˆæ¯æ¸…æ™°ï¼Œç”¨æˆ·å‹å¥½
USER_NOT_FOUND("1200", "exception.user_not_found", "ç”¨æˆ·ä¸å­˜åœ¨")

// âŒ é¿å…ï¼šæŠ€æœ¯ç»†èŠ‚æš´éœ²
DATABASE_CONNECTION_FAILED("2000", "exception.db_error", "Connection refused: localhost:3306")
```

### 3. å¼‚å¸¸å¤„ç†å±‚æ¬¡

```java
@Service
public class UserService {
    
    public User getUserById(Long id) {
        // å‚æ•°éªŒè¯
        ExceptionUtils.requireNonNull(id, "id");
        
        try {
            User user = userRepository.findById(id);
            
            // ä¸šåŠ¡éªŒè¯
            ExceptionUtils.throwBusinessIf(user == null, I18nCommonExceptionCode.USER_NOT_FOUND);
            
            return user;
        } catch (DataAccessException e) {
            // ç³»ç»Ÿå¼‚å¸¸
            throw ExceptionUtils.system(I18nCommonExceptionCode.DATABASE_ERROR, e);
        }
    }
}
```

### 4. æ—¥å¿—è®°å½•

```java
@ExceptionHandler(BusinessException.class)
public ResponseEntity<Response<Void>> handleBusinessException(BusinessException e) {
    // ä¸šåŠ¡å¼‚å¸¸è®°å½•ä¸º WARN çº§åˆ«
    log.warn("Business exception: code={}, message={}", e.getCode(), e.getMessage());
    
    return ResponseEntity.ok(buildErrorResponse(e));
}

@ExceptionHandler(SystemException.class)
public ResponseEntity<Response<Void>> handleSystemException(SystemException e) {
    // ç³»ç»Ÿå¼‚å¸¸è®°å½•ä¸º ERROR çº§åˆ«ï¼ŒåŒ…å«å †æ ˆä¿¡æ¯
    log.error("System exception: code={}, message={}", e.getCode(), e.getMessage(), e);
    
    return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(buildErrorResponse(e));
}
```

### 5. æ€§èƒ½è€ƒè™‘

- å¼‚å¸¸åˆ›å»ºæœ‰æ€§èƒ½å¼€é”€ï¼Œé¿å…åœ¨æ­£å¸¸ä¸šåŠ¡æµç¨‹ä¸­ä½¿ç”¨å¼‚å¸¸æ§åˆ¶é€»è¾‘
- å›½é™…åŒ–æ¶ˆæ¯æœåŠ¡æ”¯æŒç¼“å­˜ï¼Œé¿å…é‡å¤è§£æ
- åˆç†ä½¿ç”¨å¼‚å¸¸é“¾ï¼Œä¿ç•™åŸå§‹å¼‚å¸¸ä¿¡æ¯

## ğŸ”§ æ‰©å±•æŒ‡å—

### 1. æ·»åŠ æ–°çš„å¼‚å¸¸ç±»å‹

```java
public class IntegrationException extends BaseException {
    public IntegrationException(ExceptionCode exceptionCode) {
        super(exceptionCode);
    }
    
    // å…¶ä»–æ„é€ å‡½æ•°...
}
```

### 2. æ·»åŠ æ–°çš„å¼‚å¸¸ç 

```java
public enum IntegrationExceptionCode implements I18nExceptionCode {
    THIRD_PARTY_API_ERROR("3100", "exception.third_party_api_error", "ç¬¬ä¸‰æ–¹APIè°ƒç”¨å¤±è´¥"),
    DATA_SYNC_FAILED("3101", "exception.data_sync_failed", "æ•°æ®åŒæ­¥å¤±è´¥");
    
    // å®ç°æ¥å£æ–¹æ³•...
}
```

### 3. è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨

```java
@ExceptionHandler(IntegrationException.class)
public ResponseEntity<Response<Void>> handleIntegrationException(IntegrationException e) {
    // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
    log.error("Integration exception: {}", e.getMessage(), e);
    
    // å¯ä»¥å‘é€å‘Šè­¦ã€è®°å½•ç›‘æ§æŒ‡æ ‡ç­‰
    alertService.sendAlert("Integration Error", e.getMessage());
    
    return ResponseEntity.status(HttpStatus.BAD_GATEWAY).body(buildErrorResponse(e));
}
```

## ğŸ“š æ€»ç»“

è¯¥å¼‚å¸¸ä½“ç³»æä¾›äº†ï¼š

1. **å®Œæ•´çš„å¼‚å¸¸åˆ†ç±»** - è¦†ç›–ä¸šåŠ¡ã€éªŒè¯ã€ç³»ç»Ÿã€è®¤è¯ç­‰å„ç§åœºæ™¯
2. **å›½é™…åŒ–æ”¯æŒ** - æ”¯æŒå¤šè¯­è¨€å¼‚å¸¸æ¶ˆæ¯ï¼Œå‚æ•°åŒ–æ¨¡æ¿
3. **ç»Ÿä¸€çš„å¤„ç†æœºåˆ¶** - å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œç»Ÿä¸€å“åº”æ ¼å¼
4. **ä¾¿æ·çš„å·¥å…·æ–¹æ³•** - ç®€åŒ–å¼‚å¸¸åˆ›å»ºå’ŒæŠ›å‡ºæ“ä½œ
5. **è‰¯å¥½çš„æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°çš„å¼‚å¸¸ç±»å‹å’Œå¼‚å¸¸ç 
6. **æœ€ä½³å®è·µæŒ‡å¯¼** - æä¾›å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œæœ€ä½³å®è·µ

é€šè¿‡ä½¿ç”¨è¿™å¥—å¼‚å¸¸ä½“ç³»ï¼Œå¯ä»¥å¤§å¤§æé«˜ä»£ç çš„å¥å£®æ€§ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒã€‚