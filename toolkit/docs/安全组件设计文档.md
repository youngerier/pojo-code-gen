# å®‰å…¨ç»„ä»¶è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»toolkitæ¨¡å—ä¸­å®‰å…¨ç»„ä»¶çš„è®¾è®¡æ€è·¯ã€æ¶æ„ç»„æˆå’Œä½¿ç”¨æ–¹æ³•ã€‚å®‰å…¨ç»„ä»¶åŸºäºSpring Securityæ¡†æ¶ï¼Œæä¾›è®¤è¯ã€æˆæƒã€åŠ å¯†ã€å®¡è®¡ç­‰å®Œæ•´çš„ä¼ä¸šçº§å®‰å…¨è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

- **å¤šå±‚é˜²æŠ¤** - æä¾›è®¤è¯ã€æˆæƒã€åŠ å¯†ã€å®¡è®¡ç­‰å¤šå±‚å®‰å…¨é˜²æŠ¤
- **çµæ´»é…ç½®** - æ”¯æŒå¤šç§è®¤è¯æ–¹å¼å’Œæˆæƒç­–ç•¥
- **æ€§èƒ½ä¼˜åŒ–** - é«˜æ€§èƒ½çš„å®‰å…¨æ£€æŸ¥å’Œç¼“å­˜æœºåˆ¶
- **æ ‡å‡†å…¼å®¹** - éµå¾ªOWASPå®‰å…¨æ ‡å‡†å’Œæœ€ä½³å®è·µ
- **æ˜“äºæ‰©å±•** - æ’ä»¶åŒ–è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰å®‰å…¨ç»„ä»¶

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. å®‰å…¨å±‚æ¬¡ç»“æ„

```
å®‰å…¨æ¡†æ¶
â”œâ”€â”€ è®¤è¯å±‚ (Authentication)
â”‚   â”œâ”€â”€ ç”¨æˆ·åå¯†ç è®¤è¯
â”‚   â”œâ”€â”€ JWTä»¤ç‰Œè®¤è¯  
â”‚   â”œâ”€â”€ OAuth2è®¤è¯
â”‚   â””â”€â”€ å¤šå› ç´ è®¤è¯
â”œâ”€â”€ æˆæƒå±‚ (Authorization)
â”‚   â”œâ”€â”€ è§’è‰²æƒé™æ§åˆ¶
â”‚   â”œâ”€â”€ èµ„æºæƒé™æ§åˆ¶
â”‚   â”œâ”€â”€ æ•°æ®æƒé™æ§åˆ¶
â”‚   â””â”€â”€ APIæƒé™æ§åˆ¶
â”œâ”€â”€ åŠ å¯†å±‚ (Encryption)
â”‚   â”œâ”€â”€ å¯†ç åŠ å¯†
â”‚   â”œâ”€â”€ æ•°æ®åŠ å¯†
â”‚   â”œâ”€â”€ ä¼ è¾“åŠ å¯†
â”‚   â””â”€â”€ æ•°å­—ç­¾å
â””â”€â”€ å®¡è®¡å±‚ (Audit)
    â”œâ”€â”€ æ“ä½œæ—¥å¿—
    â”œâ”€â”€ å®‰å…¨äº‹ä»¶
    â”œâ”€â”€ ç™»å½•è®°å½•
    â””â”€â”€ æƒé™å˜æ›´
```

### 2. æ ¸å¿ƒç»„ä»¶

```
security/
â”œâ”€â”€ authentication/    # è®¤è¯ç»„ä»¶
â”œâ”€â”€ authorization/     # æˆæƒç»„ä»¶  
â”œâ”€â”€ encryption/        # åŠ å¯†ç»„ä»¶
â”œâ”€â”€ audit/            # å®¡è®¡ç»„ä»¶
â”œâ”€â”€ config/           # å®‰å…¨é…ç½®
â””â”€â”€ utils/            # å®‰å…¨å·¥å…·
```

## ğŸ” è®¤è¯ç»„ä»¶

### 1. JWTè®¤è¯é…ç½®

```java
@Configuration
@EnableWebSecurity
public class JwtSecurityConfig {
    
    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter(jwtTokenProvider());
    }
    
    @Bean
    public JwtTokenProvider jwtTokenProvider() {
        return JwtTokenProvider.builder()
                .secretKey(jwtProperties.getSecretKey())
                .tokenValidityInSeconds(jwtProperties.getTokenValidityInSeconds())
                .build();
    }
}
```

### 2. å¤šå› ç´ è®¤è¯

```java
@Service
public class MultiFactorAuthService {
    
    public boolean verifyMFA(String userId, String code, MfaType type) {
        switch (type) {
            case SMS:
                return smsVerificationService.verify(userId, code);
            case EMAIL:
                return emailVerificationService.verify(userId, code);
            case TOTP:
                return totpService.verify(userId, code);
            default:
                return false;
        }
    }
}
```

## ğŸ›¡ï¸ æˆæƒç»„ä»¶

### 1. åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping
    public Response<User> createUser(@RequestBody UserCreateRequest request) {
        return userService.createUser(request);
    }
    
    @PreAuthorize("hasPermission(#id, 'USER', 'READ')")
    @GetMapping("/{id}")
    public Response<User> getUser(@PathVariable Long id) {
        return userService.getUser(id);
    }
}
```

### 2. æ•°æ®æƒé™æ§åˆ¶

```java
@Component
public class DataPermissionHandler {
    
    @DataPermission(type = "USER_DATA")
    public List<User> filterUserData(List<User> users, Authentication auth) {
        UserDetails userDetails = (UserDetails) auth.getPrincipal();
        
        if (hasRole(userDetails, "ADMIN")) {
            return users; // ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰æ•°æ®
        }
        
        // æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®
        return users.stream()
                .filter(user -> user.getId().equals(getCurrentUserId(userDetails)))
                .collect(Collectors.toList());
    }
}
```

## ğŸ”’ åŠ å¯†ç»„ä»¶

### 1. å¯†ç åŠ å¯†å·¥å…·

```java
@Component
public class PasswordEncryptionService {
    
    private final PasswordEncoder passwordEncoder = new BCryptPasswordEncoder(12);
    
    public String encryptPassword(String rawPassword) {
        return passwordEncoder.encode(rawPassword);
    }
    
    public boolean matches(String rawPassword, String encodedPassword) {
        return passwordEncoder.matches(rawPassword, encodedPassword);
    }
}
```

### 2. æ•°æ®åŠ å¯†å·¥å…·

```java
@Component
public class DataEncryptionService {
    
    @Value("${app.encryption.key}")
    private String encryptionKey;
    
    public String encrypt(String plainText) {
        return AESUtils.encrypt(plainText, encryptionKey);
    }
    
    public String decrypt(String encryptedText) {
        return AESUtils.decrypt(encryptedText, encryptionKey);
    }
}
```

## ğŸ“Š å®¡è®¡ç»„ä»¶

### 1. æ“ä½œå®¡è®¡

```java
@Aspect
@Component
public class AuditAspect {
    
    @Around("@annotation(Auditable)")
    public Object audit(ProceedingJoinPoint joinPoint) throws Throwable {
        AuditEvent event = AuditEvent.builder()
                .userId(getCurrentUserId())
                .operation(joinPoint.getSignature().getName())
                .timestamp(LocalDateTime.now())
                .build();
        
        try {
            Object result = joinPoint.proceed();
            event.setStatus("SUCCESS");
            return result;
        } catch (Exception e) {
            event.setStatus("FAILURE");
            event.setErrorMessage(e.getMessage());
            throw e;
        } finally {
            auditService.saveAuditEvent(event);
        }
    }
}
```

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### 1. å®‰å…¨é…ç½®

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
                .csrf().disable()
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .authorizeHttpRequests(auth -> auth
                    .requestMatchers("/api/auth/**").permitAll()
                    .requestMatchers("/api/admin/**").hasRole("ADMIN")
                    .anyRequest().authenticated()
                )
                .addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class)
                .build();
    }
}
```

### 2. ç”¨æˆ·è®¤è¯

```java
@RestController
@RequestMapping("/api/auth")
public class AuthController {
    
    @PostMapping("/login")
    public Response<LoginResponse> login(@RequestBody LoginRequest request) {
        // éªŒè¯ç”¨æˆ·å‡­æ®
        Authentication auth = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(
                        request.getUsername(), 
                        request.getPassword()
                )
        );
        
        // ç”ŸæˆJWTä»¤ç‰Œ
        String token = jwtTokenProvider.generateToken(auth);
        
        return Response.success(LoginResponse.builder()
                .accessToken(token)
                .tokenType("Bearer")
                .expiresIn(jwtProperties.getTokenValidityInSeconds())
                .build());
    }
}
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. å¯†ç å®‰å…¨
- ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
- å¯†ç åŠ ç›å“ˆå¸Œå­˜å‚¨
- å®šæœŸå¯†ç è¿‡æœŸæé†’

### 2. ä¼šè¯ç®¡ç†
- ä½¿ç”¨JWTæ— çŠ¶æ€è®¤è¯
- è®¾ç½®åˆç†çš„ä»¤ç‰Œè¿‡æœŸæ—¶é—´
- æ”¯æŒä»¤ç‰Œåˆ·æ–°æœºåˆ¶

### 3. æƒé™æ§åˆ¶
- æœ€å°æƒé™åŸåˆ™
- è§’è‰²å’Œæƒé™åˆ†ç¦»
- åŠ¨æ€æƒé™æ§åˆ¶

### 4. æ•°æ®ä¿æŠ¤
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- ä¼ è¾“å±‚TLSåŠ å¯†
- æ•°æ®è„±æ•å¤„ç†

## ğŸ“š å‚è€ƒèµ„æ–™

- [Spring Security Reference](https://spring.io/projects/spring-security)
- [OWASP Security Guidelines](https://owasp.org/)
- [JWT RFC 7519](https://tools.ietf.org/html/rfc7519)